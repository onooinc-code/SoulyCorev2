
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HedraCore | تقرير معماري: مبدأ المسؤولية الواحدة</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        :root {
            --bg-color: #12101c; --surface-color: #1c182c; --primary-color: #a450e8; --secondary-color: #00bcd4; --text-color: #e0e0e0; --header-color: #ffffff; --border-color: #3a3252; --shadow-color: rgba(164, 80, 232, 0.2); --success-color: #4caf50; --error-color: #f44336; --warning-color: #ff9800; --font-size-base: 1rem;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); line-height: 1.8; direction: rtl; font-size: var(--font-size-base); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 80px 20px; background: linear-gradient(135deg, rgba(28, 24, 44, 0.9), rgba(18, 16, 28, 0.95)); border-bottom: 3px solid var(--primary-color); margin-bottom: 50px; position: relative; overflow: hidden; }
        header h1 { font-size: 3.8em; color: var(--header-color); margin: 0; font-weight: 700; text-shadow: 0 0 20px var(--shadow-color); animation: fadeIn 1s ease-out; }
        header p { font-size: 1.4em; color: #b0a8d8; margin-top: 15px; animation: fadeIn 1.2s ease-out; }
        .section { animation: fadeIn 1s ease-out; animation-fill-mode: both; }
        h2 { font-size: 2.8em; color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-top: 60px; margin-bottom: 30px; display: flex; align-items: center; gap: 15px; }
        h3 { font-size: 1.9em; color: var(--secondary-color); margin-top: 40px; margin-bottom: 20px; }
        .card { background-color: var(--surface-color); border-radius: 12px; padding: 25px 30px; margin-bottom: 25px; border: 1px solid var(--border-color); box-shadow: 0 8px 30px rgba(0,0,0,0.3); animation: slideInRight 0.8s ease-out; }
        .header-icon { width: 48px; height: 48px; color: var(--primary-color); flex-shrink: 0; }
        pre { background-color: #0d1117; padding: 20px; border-radius: 8px; margin: 25px 0; border: 1px solid var(--border-color); overflow-x: auto;}
        .card ul, .card ol { padding-right: 20px; }
        .card code { font-family: monospace; background: #2a243e; padding: 0.2em 0.4em; border-radius: 4px; font-size: 0.9em; color: #c792ea; direction: ltr; display: inline-block; }
        footer { text-align: center; margin-top: 80px; padding: 30px; border-top: 1px solid var(--border-color); color: #888; }
        .verdict { margin-top: 20px; padding: 20px; border-radius: 8px; font-weight: 600; background-color: rgba(76, 175, 80, 0.1); border-right: 5px solid var(--success-color); color: #a5d6a7; }
    </style>
    <script type="module">
        try {
            const mermaid = (await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.js')).default;
            mermaid.initialize({ startOnLoad: true, theme: 'dark', securityLevel: 'loose', fontFamily: '"Cairo", sans-serif' });
        } catch(e) { console.error("Could not load Mermaid.js", e); }
    </script>
</head>
<body class="arabic">
    <header>
        <h1 id="main-title">تقرير معماري: تطبيق مبدأ المسؤولية الواحدة وهيكلة الملفات</h1>
        <p id="main-subtitle">تقرير رقم 17: شرح تفصيلي لكيفية تطبيق المبادئ الهندسية في التحديثات الأخيرة</p>
    </header>

    <div class="container">
        <div class="section" style="animation-delay: 0.2s;">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="header-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2.25 2.25 0 003.072 0l-.548-.547a2.25 2.25 0 01.02-3.182l2.122-2.121a2.25 2.25 0 00-3.182-3.182L16.5 7.5M5.572 7.572a2.25 2.25 0 000 3.182l.547.547a2.25 2.25 0 01-3.182.02l-2.121-2.122a2.25 2.25 0 00-3.182 3.182L7.5 16.5m.518-4.471A2.25 2.25 0 0010.5 9.75h3.75a2.25 2.25 0 001.685-3.882" /></svg>
                مبدأ المسؤولية الواحدة (SRP): شرح وتطبيق
            </h2>
            <div class="card">
                <h3>ما هو المبدأ؟</h3>
                <p>مبدأ المسؤولية الواحدة هو أحد أهم المبادئ في هندسة البرمجيات، وينص على أن "كل وحدة برمجية (ملف، كلاس، مكون) يجب أن يكون لها سبب واحد فقط للتغيير".</p>
                <p>لتبسيط الأمر، تخيل فريقًا من الأطباء. بدلاً من وجود طبيب واحد "عام" يقوم بكل شيء (جراحة، طب أطفال، أمراض القلب)، لدينا أطباء متخصصون. الجرّاح مسؤول فقط عن الجراحة، وطبيب القلب مسؤول فقط عن القلب. هذا يجعلهم خبراء في مجالهم، ويجعل النظام الطبي بأكمله أكثر كفاءة وموثوقية.</p>
                <p>في مشروعنا، قمت بتطبيق هذا المبدأ بشكل صارم. كل ملف له "تخصص" واحد فقط.</p>
            </div>
        </div>
        
        <div class="section" style="animation-delay: 0.4s;">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="header-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>
                أمثلة عملية من التحديثات الأخيرة
            </h2>
            <div class="card">
                <h3>1. الخطاف المخصص `useDataSourceSettings.ts` (أفضل مثال)</h3>
                <p>في التحديث السابق، كان لدينا 11 نافذة إعدادات مختلفة. بدون تطبيق SRP، كنا سنكتب منطق جلب البيانات، وحفظها، وتتبع التعديلات، واختبار الاتصال <strong>11 مرة</strong>، مرة في كل ملف.</p>
                <p>لكن بتطبيق SRP، قمنا بفصل المسؤوليات:</p>
                <ul>
                    <li><strong>مسؤولية `useDataSourceSettings.ts`:</strong> هي "إدارة منطق وحالة إعدادات مصدر البيانات". هو الخبير الذي يعرف كيف يتحدث مع الـ API، وكيف يحفظ البيانات، وكيف يختبر الاتصال.</li>
                    <li><strong>مسؤولية كل نافذة إعدادات (مثل `VercelPostgresModal.tsx`):</strong> هي "عرض واجهة المستخدم الخاصة بإعدادات Vercel Postgres". هي لا تعرف أي شيء عن كيفية الحفظ أو الجلب، هي فقط تعرض الحقول وتستدعي الوظائف من الخبير (الـ Hook).</li>
                </ul>
                <p>هذا يعني أنه إذا أردنا تغيير طريقة الحفظ في المستقبل، سنعدل ملفًا واحدًا فقط.</p>
            </div>
            <div class="card">
                <h3>2. نمط المستودع (Repository Pattern)</h3>
                <p>هذا مثال آخر على فصل المسؤوليات بين طبقات التطبيق:</p>
                <ul>
                    <li><strong>مسؤولية نقاط الـ API (مثل `app/api/data-sources/route.ts`):</strong> هي "التعامل مع طلبات HTTP". هي تعرف كيف تقرأ الطلب وكيف ترسل الرد. هي لا تعرف شيئًا عن SQL أو قاعدة البيانات.</li>
                    <li><strong>مسؤولية المستودع (`PostgresDataSourceRepository.ts`):</strong> هي "التعامل مع قاعدة البيانات". هو الخبير الوحيد الذي يعرف كيفية كتابة استعلامات SQL لجدول `data_sources`.</li>
                </ul>
                <p>هذا الفصل يجعل الكود أكثر تنظيمًا ويسمح لنا بتغيير قاعدة البيانات في المستقبل (إذا احتجنا) دون لمس كود الـ API.</p>
            </div>
            <div class="card">
                <h3>3. هيكلة المجلدات (تقسيم الملفات)</h3>
                <p>تقسيم الملفات هو التطبيق المادي لمبدأ SRP. لقد قمت بإنشاء مجلد <code>components/data_hub/settings_modals/</code> ووضعت كل نافذة إعدادات في ملفها الخاص.</p>
                <ul>
                    <li><strong>لماذا؟</strong> لأن كل ملف أصبح له مسؤولية واحدة فقط: عرض نافذة الإعدادات لخدمة معينة. هذا يمنعنا من الحصول على ملف واحد عملاق يصعب فهمه وصيانته.</li>
                </ul>
            </div>
        </div>

        <div class="section" style="animation-delay: 0.6s;">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" class="header-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.804 4.196A.75.75 0 0017.25 3H6.75a.75.75 0 00-.554.196L3.125 6.25m17.75 0l-3.071-2.054a.75.75 0 00-.554-.196H3.125m17.75 0l-1.15 7.693a.75.75 0 01-.741.657H4.216a.75.75 0 01-.741-.657L2.325 6.25m17.75 0H2.325m0 0l-1.15-2.054A.75.75 0 01.625 3H21a.75.75 0 01.554.196L20.875 6.25m-1.75 10.5a.75.75 0 01-1.5 0v-2.25a.75.75 0 011.5 0v2.25z" /></svg>
                البنية المعمارية الناتجة
            </h2>
            <div class="card">
                <p>هذا الفصل الدقيق للمسؤوليات ينتج عنه بنية معمارية نظيفة ومتعددة الطبقات، حيث كل طبقة لها تخصصها:</p>
                <pre dir="ltr">
                    graph TD
                        subgraph "1. UI Layer (What the user sees)"
                            A["Modals (e.g., `VercelPostgresModal.tsx`)"]
                        end
                        
                        subgraph "2. Logic Layer (How the UI works)"
                            B["Custom Hook (`useDataSourceSettings.ts`)"]
                        end
                        
                        subgraph "3. API Layer (The Bridge)"
                            C["API Route (`/api/data-sources/[id]`)"]
                        end
                        
                        subgraph "4. Core/Data Access Layer (How data is managed)"
                            D["Repository (`PostgresDataSourceRepository.ts`)"]
                        end

                        subgraph "5. Persistence Layer (Where data lives)"
                            E["Database (PostgreSQL)"]
                        end
                        
                        A -- "Uses" --> B;
                        B -- "Calls" --> C;
                        C -- "Uses" --> D;
                        D -- "Accesses" --> E;
                </pre>
                <div class="verdict">
                    <strong>النتيجة:</strong> كل جزء من الكود له مسؤولية واحدة فقط، مما يجعل التطبيق بأكمله أكثر قوة، قابلية للصيانة، وقابلية للتطوير في المستقبل. أنا ملتزم تمامًا بتطبيق هذا المبدأ في جميع المهام القادمة.
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>HedraCore Cognitive Architecture v3.0 - © 2025</p>
    </footer>
</body>
</html>
